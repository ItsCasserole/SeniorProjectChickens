<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>

    <title>Simply Fowl | Dispatch Page</title>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Font Awesome JS -->
    <script src="https://kit.fontawesome.com/412b07d0f6.js" crossorigin="anonymous"></script>

    <!-- Cookies -->
    <script src = "docCookies.js"></script>
    <script src = "script.js"></script>
</head>

<body onload="startup()">
<div class="wrapper">

    <!-- Sidebar  -->
    <div>
        <nav id="sidebar" class="fixed dispatch">
            <div class="sidebar-header"><h3 class="text-center">Simply Fowl</h3></div>

            <ul class="list-unstyled components">
                <li><a href="saleshomepage.html"><i class="fas fa-home fa-fw"></i> Home</a></li>
                <li><a href="#"><i class="fas fa-box-open fa-fw"></i> Orders</a></li>
                <li class="active"><a><i class="fas fa-truck fa-fw"></i> Dispatch</a></li>
                <li><a href="#"><i class="fas fa-briefcase fa-fw"></i> Shipments</a></li>
                <li><a href="maintenance.html"><i class="fas fa-wrench fa-fw"></i> Maintenance</a></li>
                <li id="adminsub">
                    <a href="#adminSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="fas fa-user-cog fa-fw"></i> Admin</a>
                    <ul class="collapse list-unstyled" id="adminSubmenu">
                        <li><a href="flockPage.html">View Flock Info</a></li>
			<li><a href="accountsmanagement.html">Manage Accounts</a></li>
                    </ul>
                </li>
            </ul>

        </nav>
    </div>


    <!-- Page Content  -->
    <div id="content" >
        <!-- Page Header Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <button type="button" id="sidebarCollapse" class="btn"><i class="fas fa-bars"></i></button>
                <h4 class="nav navbar-nav navbar-center">Dispatches</h4>
                <ul class="nav navbar-nav navbar-right">
			<li><button type="button" class="btn btn-primary" onclick="logout()">Log Out</button></li>
                </ul>
            </div>
        </nav>

        <!-- Individual Page Content Goes Here -->

        <!-- Create New Dispatch Card -->
        <div class="card mx-auto">
            <div class="card-header">
                <h4 class="card-title">Create New Dispatch</h4>
            </div>
            <div class="card-body">

                <form>
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label for="truck">Truck</label>
                            <select id="truck" class="form-control selectpicker ">
                                <option value="-1">Choose Truck...</option>
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="driver">Driver</label>
                            <select id="driver" class="form-control selectpicker">
                                <option value="-1">Choose Driver...</option>

                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="invoices">Invoices</label>
                            <select id="invoices" class="form-control selectpicker" multiple data-live-search="true">
                            </select>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="createDispatch()">Create</button>
                </form>
            </div>
        </div>
        <br>

        <!-- Current Dispatches Card -->
        <div id="dispatches" class="card mx-auto">
            <div class="card-header">
                <h4 class="card-title">Current Dispatches</h4>
            </div>
            <div class="card-body">
                <!-- List of Invoices in Route assigned to truck driver -->
                <div id="dispatchList" class="list-group">
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="dispatchModal" tabindex="-1" role="dialog" aria-labelledby="invoiceModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="dispatchModalLabel">Dispatch Details</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <!-- Individual Invoice Details will be filled in here -->
                        <div id="invoicePopup" class="modal-body">
                            <h5>Truck:</h5>
                            <p id="popupTruckVIN"></p>
                            <p id="popupTruckLicense"></p>
                            <hr>
                            <h5>Truck Driver:</h5>
                            <p id="popupTruckDriver"></p>

                            <hr>

                            <!-- Table for Invoices in Dispatch -->
                            <h5>Dispatch Details</h5>
                            <div class="table-responsive" id="dispatchInvoiceTable">
                                <table class="table table-bordered table-hover" >
                                    <thead>
                                    <tr>
                                        <th>Invoice Number</th>
                                        <th>Store</th>
                                    </tr>
                                    </thead>

                                    <!-- Invoices -->
                                    <tbody id="dispatchInvoiceTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- END OF INDIVIDUAL PAGE CONTENT -->

    </div>
</div>

<!-- Needed for bootstrap -->
<!-- Popper.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>


<!-- Collapse/Open Sidebar -->
<script type="text/javascript">
    $(document).ready(function () {
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active')
        });



        // Add Trucks to dropdown
        //TODO: retrieve actual trucks from db and have their option value be their truckID
        var truckStr = "";
        for (i = 0; i < 10; i++)
        {
            truckStr = `<option value="${i}">Truck ${i}</option>`;
            $('#truck').append(truckStr)
        }

        // Add Truck Drivers to dropdown
        //TODO: retrieve actual truck drivers from db and have their option value be their truckdriverID
        var driverStr = "";
        for (i = 0; i < 10; i++)
        {
            driverStr = `<option value="${i}">Driver ${i}</option>`;
            $('#driver').append(driverStr)
        }

        // Add Invoices to dropdown
        //TODO: retrieve actual (not dispatched) invoices from db and have their option value be their invoiceID
        var invoiceStr = "";
        for (i = 0; i < 10; i++)
        {
            invoiceStr = `<option value="${i}">Invoice #: ${i}</option>`;
            $('#invoices').append(invoiceStr)
        }

        // instanciate selects
        $('select').selectpicker();

        //--------------------------------------------------------------------------------------------------------------
        // Add dispatch buttons to current dispatch list
        // Depends on what we want this list should show
        // 2 possibilities:
        // 1. List displays dispatched invoices
        //    clicking on item in list will bring up a modal with information
        //      about the truck and driver associated to that invoice
        //      as well as a table that includes all dispatched invoices associated to that truck and driver
        //      which would include the clicked invoice

        // 2. List displays Trucks and Drivers that have been dispatched
        //    clicking on item in list will bring up modal with information about truck, driver
        //        and a table of invoices associated to that dispatchID
        //
        //    to do this we'd need to:
        //    Add "Dispatches" table in the db
        //    it would hold dispatch id, truck driver id, and truck id numbers
        //    then we'd need to add a column to invoices that associates the invoice to a dispatch

        //TODO For Option 1:
        //TODO: retrieve actual (dispatched) invoices from db
        //TODO: call populatePopup on their invoiceID

        //TODO for Option 2:
        //TODO: retrieve actual dispatches from db
        //TODO: call populatePopup on the dispatchID
        var dispatchStr = "";
        for (i = 0; i < 100; i++)
        {
            dispatchStr = `<button type="button" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#dispatchModal" onclick="populatePopup(${i})">Dispatch Item ${i}</button>`;
            $('#dispatchList').append(dispatchStr)
        }
        // -------------------------------------------------------------------------------------------------------------

    });

    // Change Modal Information based on invoice that was clicked
    function populatePopup(invoiceId)
    {
        //TODO: replace the following values with correct values from the specified invoice
        document.getElementById("popupTruckVIN").innerHTML = "VIN:  " + invoiceId;
        document.getElementById("popupTruckLicense").innerHTML = "License Plate: " + invoiceId;
        document.getElementById("popupTruckDriver").innerHTML = "Driver " + invoiceId;

        // Clear Table body
        document.getElementById("dispatchInvoiceTableBody").innerHTML = "";

        // populate table with invoice info
        // (if dispatch table is added we would query based on dispatch id and not the truck driver and truck)
        //TODO: add correct invoice # and store in table row for each invoice with the same truck driver and truck as the invoice passed in
        var invoiceRow = "";
        for (i=0; i < 10; i++) {
            invoiceRow = `<tr><td>${invoiceId} Invoice #: ${i}</td><td>Store: ${i}</td></tr>`;
            $('#dispatchInvoiceTableBody').append(invoiceRow);
        }
    }

    function createDispatch()
    {
        // Get input values
        var truckId = $('#truck').selectpicker('val');
        var driverId = $('#driver').selectpicker('val');
        var invoicesArr = $('#invoices').selectpicker('val');

        // make sure all fields are entered
        if(invoicesArr.length <= 0 || (truckId < 0 || driverId < 0))
        {
            alert("Error: All fields not entered");
        }
        else {
            //TODO: populate truckID and and truckdriverID for each invoice in invoiceArr
            for (i = 0; i < invoicesArr.length; i++) {
                alert("Add Truck ID: " + truckId + " and Driver ID: " + driverId + " to Invoice: " + invoicesArr[i]);
            }
        }

    }

function startup(){
	loggedin();
	checkPermissions("Sales Manager");
}

</script>



</body>

</html>

