<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content = "width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content = "IE=edge">
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
	<script type='text/javascript' src='main.js'></script>
	<title>Simply Fowl | Flock Manager</title>

	<!-- Bootstrap CSS CDN -->
	<link rel="stylesheet"
       		href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
		crossorigin="anonymous">

	<!-- Our Custom CSS -->
	<link rel="stylesheet" href="style.css">

	<!-- Font Awesome JS --!>
	<script src="https://kit.fontawesome.com/412b07d0f6.js" crossorigin="anonymous"></script>
</head>
<body>
<div class="wrapper">        
	<!--Sidebar--!>
	 <div>
	 <nav id="sidebar" class="fixed">
	 	<div class="sidebar-header"><h3 class="text-center">Simply Fowl</h3></div>
	 	<ul class="list-unstyled components">
	 		<li><a href="FlockManager.html"><i class="fas fa-home fa-fw"></i> Home</a></li>
	 		<li class="active"><a href="flockPage.html"><i class="fas fa-feather fa-fw"></i> Manage Flocks</a></li>
	 		<li><a href="farmPage.html"><i class="fas fa-tractor fa-fw"></i> Manage Farms </a></li>
	 	</ul>
	 </nav>
</div>																								           <!--page content-->											
<div id="content">
	<!-- Page Header Navbar -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid">
			<button type="button" id="sidebarCollapse" class="btn"><i class="fas fa-bars"></i></button>
			<h4 class="nav navbar-nav navbar-center">Manage Flocks</h4>																			   <ul class="nav navbar-nav navbar-right">
				<li><a href="#">Log Out</a></li>
			</ul>
		</div>
	</nav>
	
	<!--flock info box--!>
	<div class = "card">
	    	<div class = "card-body">
			<h5 class="card-title">Available Flocks</h5>
		
		<!--dropdown--!>
		<select id="farm" class="farmList"></select>
		<br><br>
		<!--flock info--!>
	  	<p class="card-text"><b>Flock Information:</b><br></p>
		<div id="flockInfo"></div>
		</div>
	</div>
	<br>
	    
	<!--add flock box--!>
	<div class="card">
		<div class="card-body">
			<h5 class="card-title">Add New Flock</h5>
		<form id='createFlock' action='#' method='post'>
			<div class="form-group">
			<label for="farmName"><b>Farm</b></label><br>
				<select name="farm_id" class="farmList" required></select>
			</div>
			<div class="form-group">
			<label for="building"><b>Building</b></label><br>
				<select name="building_id" class="buildingList" required></select>
			</div>
			<div class="form-group">
			<label for="delivery"><b>Delivery Date</b></label><br>
			<input type="date" name="delivery_date" placeholder="YYYY-MM-DD" required></input>
			</div>
			<div class="form-group">
			<label for="hatchlings"><b>No. of Hatchlings</b></label><br>
			<input name="hatchlings" type="text" placeholder="# of Hatchlings" required></input>
			</div>
			<div class="form-group">
			<label for="breed"><b>Bird Type</b></label><br>
			<select name="bird_type_id" class="birdList" required></select>
			</div>
			<br>
			<button type="submit" class="btn btn-primary">Add New Flock</button>
                        <button class="btn btn-primary">Clear</button>
			</form>
		</div>
	</div>
	</div></div>
	
	
	<!-- Needed for bootstrap -->
	<!-- jQuery CDN - Slim version (=without AJAX) -->
	<script src="https://codquery.com/jquery-3.3.1.slim.min.js"
	 integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
	crossorigin="anonymous">
	</script>                                                                      
	
	<!-- Popper.JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
	 integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
crossorigin="anonymous">
	</script>

	<!-- Bootstrap JS -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
	 integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
crossorigin="anonymous">
	</script>

	<!-- Collapse/Open Sidebar -->
	<script type="text/javascript">
	$(document).ready(function () {
		var farm = "api/farm/read.php";
		var building = "api/building/read.php";
		var bird = "api/bird/read.php";
		var flock = "api/flock/read.php";
		//populate farm, building, and bird dropdowns
		//create and populate flock table
		$.getJSON(farm, function(farmData){
			$.getJSON(building, function(buildingData){
				$.getJSON(bird, function(birdData){
					$.getJSON(flock, function(flockData){
				var farmStr = '';
				var buildingStr = '';
			        var birdStr = '';
				var tableStr = `<table class='table tabl-bordered table-hover'>
                                    <!-- creating our table heading -->
                                        <tr>
                                                <th class='w-15-pct'>Farm Name</th>
                                                <th class='w-5-pct'>Building #</th>
                                                <th class='w-5-pct'>Building Floor</th>
                                                <th class='w-15-pct'>Bird Type</th>
						<th class='w-10-pct'>Delivery Date</th>
						<th class='w-10-pct'>Hatchlings</th>
                                                <th class='w-25-pct text-align-center'>Action</th>
                                        </tr>`;
				$.each(farmData.records, function(key,val){
                                    farmStr +=`<option value='` + val.farm_id + `'>` + val.farm_name + `</option>`;
					});
				$.each(buildingData.records, function(key,val){
                                   buildingStr +=`<option value='` + val.building_id + `'>Building: ` + val.building_number + ` Floor: ` + val.building_floor + `</option>`;
                                        });
				$.each(birdData.records, function(key,val){
                                    birdStr +=`<option value='` + val.bird_type_id + `'>` + val.bird_desc + `</option>`;
                                        });
						$.each(flockData.records, function(key,val){
							tableStr += `<tr>
                                <td>` + val.farm_name + `</td>
                                <td>` + val.building_number +`</td>
                                <td>` + val.building_floor + `</td>
                                <td>` + val.bird_desc + `</td>
				<td>` + val.delivery_date + `</td>
				<td>` + val.hatchlings + `</td>
                                <td>
                                    <button class='btn btn-info m-r-10px updateFlock' data-id='` + val.flock_id + `'>Update</button>
                                    <button class='btn btn-danger m-r-10px removeFlock' data-id='` + val.flock_id + `'>Remove</button>
                                </td>
                                </tr>`;
                });
                                tableStr += `</table>`;

				$('.farmList').append(farmStr);
				$('.buildingList').append(buildingStr);
			        $('.birdList').append(birdStr);

			        $('#flockInfo').append(tableStr);
				});
				});
			});
		});

		//create new flock
		$(document).on('submit', '#createFlock', function(){
			var form_data=JSON.stringify($(this).serializeObject());
			$.ajax({
				url : "api/flock/create.php",
				type : "POST",
				contentType : 'application/json',
				data : form_data,
				success : function(result) {
					alert("New Flock Added!");
					window.location.reload();
				},
				error : function(xhr, resp, text){
					console.log(xhr, resp, text);
				}
			});
		return false;
		});
	});
        </script>
</body>
</html>
